function showTab(tabId) {
    // ·∫®n t·∫•t c·∫£ c√°c tab
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    // Hi·ªán tab ƒë∆∞·ª£c ch·ªçn
    const selectedTab = document.getElementById(tabId);
    selectedTab.style.display = 'block';

    // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t tab
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');
}

function themgv() {
    // Hi·ªÉn th·ªã modal
    const modal = document.getElementById('modalThemgv');
    modal.style.display = 'block';

    // Hi·ªÉn th·ªã tab ƒë·∫ßu ti√™n m·∫∑c ƒë·ªãnh
    showTab('tab-manual');
}



document.addEventListener('DOMContentLoaded', function () {
    console.log('Script loaded successfully'); // Debug: Ki·ªÉm tra script ƒë√£ t·∫£i

    // L·∫•y t·∫•t c·∫£ n√∫t "con m·∫Øt"
    const buttons = document.querySelectorAll('.view-password-btn');
    
    // G·∫Øn s·ª± ki·ªán click cho t·ª´ng n√∫t
    buttons.forEach(button => {
        button.addEventListener('click', function () {
            console.log('Eye button clicked'); // Debug: Ki·ªÉm tra s·ª± ki·ªán click

            // L·∫•y ph·∫ßn t·ª≠ m·∫≠t kh·∫©u li·ªÅn tr∆∞·ªõc n√∫t
            const passwordElement = this.previousElementSibling;

            if (!passwordElement) {
                console.error('Password element not found!'); // Debug: N·∫øu kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠
                return;
            }   

            // Ki·ªÉm tra v√† thay ƒë·ªïi hi·ªÉn th·ªã m·∫≠t kh·∫©u
            if (passwordElement.style.webkitTextSecurity === 'disc') {
                passwordElement.style.webkitTextSecurity = 'none'; // Hi·ªÉn th·ªã m·∫≠t kh·∫©u
                this.textContent = 'üîì'; // ƒê·ªïi bi·ªÉu t∆∞·ª£ng
            } else {
                passwordElement.style.webkitTextSecurity = 'disc'; // ·∫®n m·∫≠t kh·∫©u
                this.textContent = 'üîí'; // ƒê·ªïi l·∫°i bi·ªÉu t∆∞·ª£ng
            }
        });
    });
});


function togglePassword(inputId, button) {
    const passwordInput = document.getElementById(inputId);

    if (passwordInput.type === "password") {
        passwordInput.type = "text"; // Hi·ªÉn th·ªã m·∫≠t kh·∫©u
        button.textContent = "üîì"; // ƒê·ªïi bi·ªÉu t∆∞·ª£ng
    } else {
        passwordInput.type = "password"; // ·∫®n m·∫≠t kh·∫©u
        button.textContent = "üîí"; // ƒê·ªïi l·∫°i bi·ªÉu t∆∞·ª£ng
    }
}




document.getElementById('formThemgv').addEventListener('submit', function (event) {
    event.preventDefault();
    const formData = new FormData(this);

    fetch('./xulythemgv.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.text())
    .then(data => {
        console.log(data);
        alert('Gi·∫£ng vi√™n ƒë∆∞·ª£c th√™m th√†nh c√¥ng!');
        closeModal('modalThemgv'); // ƒê√≥ng modal
        location.reload(); // T·∫£i l·∫°i danh s√°ch
    })
    .catch(error => console.error('L·ªói:', error));
});


// th√™m excel
document.getElementById('formExcel').addEventListener('submit', async function (event) {
    event.preventDefault(); // NgƒÉn form g·ª≠i theo c√°ch m·∫∑c ƒë·ªãnh
    
    const formData = new FormData(this); // T·∫°o FormData t·ª´ form
    
    try {
        const response = await fetch('./xulythemgvExcel.php', {
            method: 'POST',
            body: formData,
        });

        const result = await response.json(); // Chuy·ªÉn ƒë·ªïi JSON tr·∫£ v·ªÅ

        if (result.success) {
            alert('T·∫£i d·ªØ li·ªáu th√†nh c√¥ng: ' + result.message.join('\\n')); // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
            closeModal('modalThemgv'); // ƒê√≥ng modal
            location.reload(); // T·∫£i l·∫°i danh s√°ch
        } else {
            alert('T·∫£i d·ªØ li·ªáu th·∫•t b·∫°i: ' + result.errors.join('\\n')); // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        }
    } catch (error) {
        alert('C√≥ l·ªói x·∫£y ra: ' + error.message); // X·ª≠ l√Ω l·ªói kh√¥ng mong mu·ªën
    }
});

document.getElementById('xuatExcelGV').addEventListener('click', () => {
    fetch('./xuatExcelGV.php', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // T·∫£i file v·ªÅ
            const link = document.createElement('a');
            link.href = data.file;
            link.download = data.file.split('/').pop();
            link.click();
            alert('Xu·∫•t file Excel th√†nh c√¥ng!');
        } else {
            alert('L·ªói: ' + data.message);
        }
    })
    .catch(error => {
        alert('ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh xu·∫•t file.');
        console.error(error);
    });
});






// Hi·ªÉn th·ªã modal s·ª≠a v√† ƒëi·ªÅn th√¥ng tin
function hienthisuaGv(ma, hoten, trinhdo, chucvu, email, sdt, diachi) {
    console.log({ ma, hoten, trinhdo, chucvu, email, sdt, diachi });

    // Hi·ªÉn th·ªã modal s·ª≠a gi·∫£ng vi√™n
    document.getElementById('model-suagv').style.display = 'flex';

    // G√°n gi√° tr·ªã v√†o c√°c tr∆∞·ªùng
    document.getElementById('suagv-ma').value = ma;
    document.getElementById('suagv-hoten').value = hoten;
    document.getElementById('suagv-trinhdo').value = trinhdo; // Dropdown tr√¨nh ƒë·ªô
    document.getElementById('suagv-email').value = email;
    document.getElementById('suagv-sdt').value = sdt;
    document.getElementById('suagv-diachi').value = diachi;
}


  
  // ƒê√≥ng modal
  function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
  }
  
  // L∆∞u thay ƒë·ªïi
  function saveChangesGV() {
    const form = document.getElementById('form-suagv');
    const formData = new FormData(form);
  
    fetch('./xulysuaGv.php', {
      method: 'POST',
      body: formData,
    })
      .then(response => response.text())
      .then(data => {
        alert(data);
        location.reload(); // T·∫£i l·∫°i trang sau khi l∆∞u
      })
      .catch(error => console.error('L·ªói:', error));
  }
  

  function xoaGv(ma) {
    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a gi·∫£ng vi√™n n√†y?')) {
      fetch('./xulyxoaGv.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'ma=' + ma,
      })
        .then(response => response.text())
        .then(data => {
          alert(data);
          location.reload(); // T·∫£i l·∫°i trang sau khi x√≥a
        })
        .catch(error => console.error('L·ªói:', error));
    }
  }
  

  document.getElementById("search-giangvien").addEventListener("input", function () {
    const keyword = this.value.toLowerCase(); // L·∫•y t·ª´ kh√≥a t√¨m ki·∫øm v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
    const table = document.querySelector("#giangvien-section table tbody"); // Ch·ªâ ch·ªçn b·∫£ng d·ªØ li·ªáu gi·∫£ng vi√™n
    const rows = table.querySelectorAll("tr"); // L·∫•y t·∫•t c·∫£ c√°c d√≤ng trong tbody c·ªßa b·∫£ng

    rows.forEach(row => {
        // L·∫•y to√†n b·ªô text trong c√°c √¥ c·ªßa d√≤ng
        const rowText = row.textContent.toLowerCase();

        if (keyword && rowText.includes(keyword)) {
            row.style.backgroundColor = "lightgreen"; // ƒê·ªïi n·ªÅn th√†nh xanh l√° cho c√°c d√≤ng kh·ªõp
        } else {
            row.style.backgroundColor = ""; // Tr·∫£ l·∫°i n·ªÅn m·∫∑c ƒë·ªãnh cho c√°c d√≤ng kh√¥ng kh·ªõp
        }
    });
});



// Sinh vi√™n


// H√†m hi·ªÉn th·ªã tab
function showTab(tabId) {
    // ·∫®n t·∫•t c·∫£ c√°c tab
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    // Hi·ªán tab ƒë∆∞·ª£c ch·ªçn
    const selectedTab = document.getElementById(tabId);
    if (selectedTab) {
        selectedTab.style.display = 'block';
    }

    // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t tab
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    const activeButton = document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`);
    if (activeButton) {
        activeButton.classList.add('active');
    }
}

// Hi·ªÉn th·ªã modal th√™m sinh vi√™n
function themSv() {
    const modal = document.getElementById('modalThemSV');
    if (modal) {
        modal.style.display = 'block';
        showTab('tab-manualSv'); // Hi·ªÉn th·ªã tab m·∫∑c ƒë·ªãnh
    }
}

const formThemsv = document.getElementById('formThemSv');
if (formThemsv) {
    formThemsv.addEventListener('submit', function (event) {
        event.preventDefault();
        const formData = new FormData(this);

        fetch('./xulythemSV.php', {
            method: 'POST',
            body: formData
        })
            .then(response => response.text())
            .then(data => {
                alert('Sinh vi√™n ƒë∆∞·ª£c th√™m th√†nh c√¥ng!');
                closeModal('modalThemSV');
                location.reload();
            })
            .catch(error => console.error('L·ªói:', error));
    });
}


// th√™m excel
document.getElementById('formExcelSv').addEventListener('submit', async function (event) {
    event.preventDefault(); // NgƒÉn kh√¥ng cho form g·ª≠i theo c√°ch th√¥ng th∆∞·ªùng
    
    const formData = new FormData(this); // L·∫•y d·ªØ li·ªáu t·ª´ form
    
    try {
        const response = await fetch('./xulythemsvExcel.php', {
            method: 'POST',
            body: formData,
        });

        const result = await response.json(); // Chuy·ªÉn ph·∫£n h·ªìi JSON t·ª´ PHP th√†nh ƒë·ªëi t∆∞·ª£ng JavaScript

        if (result.success) {
            alert('T·∫£i d·ªØ li·ªáu th√†nh c√¥ng: ' + result.message.join('\n')); // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
            closeModal('modalThemSV');
            location.reload();
        } else {
            alert('T·∫£i d·ªØ li·ªáu th·∫•t b·∫°i: ' + result.errors.join('\n')); // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        }
    } catch (error) {
        alert('C√≥ l·ªói x·∫£y ra: ' + error.message); // X·ª≠ l√Ω l·ªói kh√¥ng mong mu·ªën
    }
});


// Hi·ªÉn th·ªã modal s·ª≠a sinh vi√™n v√† ƒëi·ªÅn th√¥ng tin
function hienthisuaSV(ma, hoten, diachi, diemtichluy, email, sdt, lop,khoa) {
    const modal = document.getElementById('model-suasv');
    if (modal) {
        modal.style.display = 'block';

        document.getElementById('suasv-ma').value = ma;
        document.getElementById('suasv-hoten').value = hoten;
        document.getElementById('suasv-lop').value = lop;
        document.getElementById('suasv-diem').value = diemtichluy;
        document.getElementById('suasv-email').value = email;
        document.getElementById('suasv-sdt').value = sdt;
        document.getElementById('suasv-diachi').value = diachi;
        document.getElementById('suasv-khoa').value = khoa;
    }
}


// L∆∞u thay ƒë·ªïi khi s·ª≠a sinh vi√™n
function saveChangesSV() {
    const form = document.getElementById('form-suasv');
    if (form) {
        const formData = new FormData(form);

        fetch('./xulysuaSv.php', {
            method: 'POST',
            body: formData,
        })
            .then(response => response.text())
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => console.error('L·ªói:', error));
    }
}

// X√≥a sinh vi√™n
function xoaSv(ma) {
    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a sinh vi√™n n√†y?')) {
        fetch('./xulyxoaSv.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'ma=' + encodeURIComponent(ma),
        })
            .then(response => response.text())
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => console.error('L·ªói:', error));
    }
}

// T√¨m ki·∫øm sinh vi√™n
const searchInput = document.getElementById('timSV');
if (searchInput) {
    searchInput.addEventListener('input', function () {
        const keyword = this.value.toLowerCase();
        const table = document.querySelector('#sinhvien-section table tbody');
        if (!table) return;

        const rows = table.querySelectorAll('tr');
        rows.forEach(row => {
            const rowText = row.textContent.toLowerCase();
            row.style.backgroundColor = keyword && rowText.includes(keyword) ? 'lightgreen' : '';
        });
    });
}


document.getElementById('xuatExcelSV').addEventListener('click', () => {
    alert("hehehehehe");
    fetch('./xuatExcelSV.php', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // T·∫£i file v·ªÅ
            const link = document.createElement('a');
            link.href = data.file;
            link.download = data.file.split('/').pop();
            link.click();
            alert('Xu·∫•t file Excel th√†nh c√¥ng!');
        } else {
            alert('L·ªói: ' + data.message);
        }
    })
    .catch(error => {
        alert('ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh xu·∫•t file.');
        console.error(error);
    });
});



// qu·∫£n l√Ω qu·∫£n tr·ªã vi√™n

// Hi·ªÉn th·ªã modal th√™m qu·∫£n tr·ªã
function themQT() {
    const modal = document.getElementById('modalThemQT');
    if (modal) {
        modal.style.display = 'block';
        showTab('tab-manualQT'); // Hi·ªÉn th·ªã tab m·∫∑c ƒë·ªãnh
    }
}

// G·ª≠i form th√™mqu·∫£n tr·ªã
const formThemqt = document.getElementById('formThemQT');
if (formThemqt) {
    formThemqt.addEventListener('submit', function (event) {
        event.preventDefault();
        const formData = new FormData(this);

        fetch('./xulythemQT.php', {
            method: 'POST',
            body: formData
        })
            .then(response => response.text())
            .then(data => {
                alert('Sinh vi√™n ƒë∆∞·ª£c th√™m th√†nh c√¥ng!');
                closeModal('modalThemQT');
                location.reload();
            })
            .catch(error => console.error('L·ªói:', error));
    });
}

document.getElementById('formExcelQT').addEventListener('submit', async function (event) {
    event.preventDefault();
    if (this.dataset.submitting === 'true') return;

    this.dataset.submitting = 'true';

    const formData = new FormData(this);

    try {
        const response = await fetch('./xulythemqtExcel.php', {
            method: 'POST',
            body: formData,
        });

        const text = await response.text(); // L·∫•y ph·∫£n h·ªìi d∆∞·ªõi d·∫°ng vƒÉn b·∫£n
        console.log('Ph·∫£n h·ªìi t·ª´ PHP:', text);

        const result = JSON.parse(text); // Chuy·ªÉn ƒë·ªïi sang JSON

        if (result.success) {
            alert('T·∫£i d·ªØ li·ªáu th√†nh c√¥ng: ' + result.message.join('\n'));
            closeModal('modalThemQT');
            location.reload();
        } else {
            alert('T·∫£i d·ªØ li·ªáu th·∫•t b·∫°i: ' + result.errors.join('\n'));
        }
    } catch (error) {
        console.error('L·ªói x·ª≠ l√Ω:', error);
        alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
        alert('vailon');
    } finally {
        this.dataset.submitting = 'false';
    }
});





// Hi·ªÉn th·ªã modal s·ª≠a sinh vi√™n v√† ƒëi·ªÅn th√¥ng tin
function hienthisuaQT(ma, hoten, diachi,  email, sdt) {
    const modal = document.getElementById('model-suaqt');
    if (modal) {
        modal.style.display = 'block';

        document.getElementById('suaqt-ma').value = ma;
        document.getElementById('suaqt-hoten').value = hoten;
        document.getElementById('suaqt-email').value = email;
        document.getElementById('suaqt-sdt').value = sdt;
        document.getElementById('suaqt-diachi').value = diachi;
    }
}


// L∆∞u thay ƒë·ªïi khi s·ª≠a sinh vi√™n
function saveChangesQT() {
    const form = document.getElementById('form-suaqt');
    if (form) {
        const formData = new FormData(form);

        fetch('./xulysuaQt.php', {
            method: 'POST',
            body: formData,
        })
            .then(response => response.text())
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => console.error('L·ªói:', error));
    }
}

// X√≥a qu·∫£n tr·ªã
function xoaQT(ma) {
    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a qu·∫£n tr·ªã n√†y?')) {
        fetch('./xulyxoaQt.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'ma=' + encodeURIComponent(ma),
        })
            .then(response => response.text())
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => console.error('L·ªói:', error));
    }
}

// T√¨m ki·∫øm sinh vi√™n
const searchInput2 = document.getElementById('timQT');
if (searchInput2) {
    searchInput2.addEventListener('input', function () {
        const keyword = this.value.toLowerCase();
        const table = document.querySelector('#quantrivien-section table tbody');
        if (!table) return;

        const rows = table.querySelectorAll('tr');
        rows.forEach(row => {
            const rowText = row.textContent.toLowerCase();
            row.style.backgroundColor = keyword && rowText.includes(keyword) ? 'lightgreen' : '';
        });
    });
}


document.getElementById('xuatExcelQT').addEventListener('click', () => {
    fetch('./xuatExcelQT.php', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // T·∫£i file v·ªÅ
            const link = document.createElement('a');
            link.href = data.file;
            link.download = data.file.split('/').pop();
            link.click();
            alert('Xu·∫•t file Excel th√†nh c√¥ng!');
        } else {
            alert('L·ªói: ' + data.message);
        }
    })
    .catch(error => {
        alert('ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh xu·∫•t file.');
        console.error(error);
    });
});










  // // X·ª≠ l√Ω x√°c th·ª±c m·∫≠t kh·∫©u n√¢ng cao
    // document.getElementById('form-mknangcao').addEventListener('submit', function (e) {
    //     e.preventDefault();
    //     const tenTK = this.dataset.tentk;
    //     const mkNangCao = document.getElementById('input-mknangcao').value;

    //     console.log(`Verifying advanced password for: ${tenTK}`); // Debug

    //     // G·ª≠i y√™u c·∫ßu x√°c th·ª±c m·∫≠t kh·∫©u n√¢ng cao
    //     fetch('./xacthucmknangcao.php', {
    //         method: 'POST',
    //         headers: { 'Content-Type': 'application/json' },
    //         body: JSON.stringify({ tentk: tenTK, mknangcao: mkNangCao })
    //     })
    //         .then(response => response.json())
    //         .then(data => {
    //             console.log(data); // Debug k·∫øt qu·∫£ tr·∫£ v·ªÅ
    //             if (data.success) {
    //                 currentPasswordElement.style.webkitTextSecurity = 'none'; // Hi·ªÉn th·ªã m·∫≠t kh·∫©u
    //                 alert('M·∫≠t kh·∫©u n√¢ng cao ƒë√∫ng! ƒê√£ hi·ªÉn th·ªã m·∫≠t kh·∫©u.');
    //             } else {
    //                 alert('M·∫≠t kh·∫©u n√¢ng cao kh√¥ng ch√≠nh x√°c!');
    //             }
    //         })
    //         .catch(err => {
    //             console.error('L·ªói:', err);
    //             alert('C√≥ l·ªói x·∫£y ra khi x√°c th·ª±c m·∫≠t kh·∫©u n√¢ng cao.');
    //         });
    // });


// Hi·ªÉn th·ªã modal s·ª≠a sinh vi√™n v√† ƒëi·ªÅn th√¥ng tin
function hienthisuaTK(ma, hoten, quyen,  mk, tt) {
    const modal = document.getElementById('model-suatk');
    if (modal) {
        modal.style.display = 'block';

        document.getElementById('suatk-ma').value = ma;
        document.getElementById('suatk-tentk').value = hoten;
        document.getElementById('suatk-quyen').value = quyen;
        document.getElementById('suatk-mk').value = mk;
        document.getElementById('suatk-tt').value = tt;
    }
}


// L∆∞u thay ƒë·ªïi khi s·ª≠a sinh vi√™n
function saveChangesTK() {
    const form = document.getElementById('form-suatk');
    if (form) {
        const formData = new FormData(form);

        fetch('./xulysuaTk.php', {
            method: 'POST',
            body: formData,
        })
            .then(response => response.text())
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => console.error('L·ªói:', error));
    }
}

const searchInput3 = document.getElementById('timTK');
if (searchInput3) {
    searchInput3.addEventListener('input', function () {
        const keyword = this.value.toLowerCase();
        const table = document.querySelector('#taikhoan-section table tbody');
        if (!table) return;

        const rows = table.querySelectorAll('tr');
        rows.forEach(row => {
            const rowText = row.textContent.toLowerCase();
            row.style.backgroundColor = keyword && rowText.includes(keyword) ? 'lightgreen' : '';
        });
    });
}




// G·ªçi showLoading() tr∆∞·ªõc khi t·∫£i l·∫°i trang ho·∫∑c g·ª≠i form
document.querySelector('form').addEventListener('submit', (event) => {
    showLoading();
});

// ·∫®n overlay sau khi h√†nh ƒë·ªông k·∫øt th√∫c
window.addEventListener('DOMContentLoaded', hideLoading);


// Hi·ªÉn th·ªã loading khi trang b·∫Øt ƒë·∫ßu t·∫£i
window.addEventListener('load', () => {
    showLoading();
});

// Hi·ªÉn th·ªã loading khi th·ª±c hi·ªán m·ªôt h√†nh ƒë·ªông (v√≠ d·ª•: t·∫£i l·∫°i trang ho·∫∑c g·ª≠i form)
function showLoading() {
    const loadingOverlay = document.getElementById('loading-overlay');
    loadingOverlay.style.display = 'block'; // Hi·ªÉn th·ªã overlay

    // ·∫®n overlay sau 2 gi√¢y
    setTimeout(() => {
        loadingOverlay.style.display = 'none';
    }, 1200);
}

function hideLoading() {
    document.getElementById('loading-overlay').style.display = 'none';
}
